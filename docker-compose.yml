services:
  # Frontend Blazor WebAssembly
  client:
    build:
      context: .
      dockerfile: BlazorGame.Client/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
    networks:
      - internal-network

  # Gateway API (point d'entrée pour les services backend)
  gateway:
    build:
      context: .
      dockerfile: BlazorGame.Gateway/Dockerfile
    ports:
      - "5000:5000" # Port exposé pour la gateway
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker
      - CLIENT_SERVICE_URL=http://client:80
    depends_on:
      - client
      - auth-service
      - core-service
    networks:
      - internal-network

  # Service d'authentification
  auth-service:
    build:
      context: .
      dockerfile: AuthenticationServices/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
    networks:
      - internal-network
    # Pas de port exposé publiquement, seulement accessible via la gateway

  # Service principal du jeu
  core-service:
    build:
      context: .
      dockerfile: BlazorGame.Core/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
    networks:
      - internal-network
    # Pas de port exposé publiquement, seulement accessible via la gateway

networks:
  internal-network:
    driver: bridge
